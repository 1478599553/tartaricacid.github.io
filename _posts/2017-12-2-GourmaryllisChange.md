---
layout: post
title: 植物魔法彼方兰的变动
tags: [wiki]
description: >
  变化不大，但是很淡疼。
---

作为植物魔法中性价比较高的产能花，彼方兰一直为我们津津乐道。产魔速度快，效果好，而且只需要投喂食物即可。配合上潘马思模组的一些可以大量种植的食物，或者其他模组的高效农场，阵列彼方兰来分分钟灌满魔力，是很轻松的事情。

然而这种简单投喂的局面稍微被某些人修改了。今年8月2号，植物魔法的美工作者[williewillus](https://github.com/williewillus)对彼方兰做了些许修改，使得单一投喂一种食物的来产魔变得不可行，彼方兰会记住上次最后投喂的食物，使其产魔量越来越低。到了9月3号，vazkii又做了修改，使彼方兰产魔量由$$饱食度^2\times64​$$变为了$$饱食度^2\times70​$$，同时彼方兰本身储魔量由`8000`变成了`9000`。

所以，我们来总结下彼方兰产魔的判定机制。此处参考Vazkii的植物魔法[源码](https://github.com/Vazkii/Botania/blob/master/src/main/java/vazkii/botania/common/block/subtile/generating/SubTileGourmaryllis.java)。

1. 彼方兰会判定其自身3×3×3立方体内是否有食物，如果有，就直接吃掉。
2. 依据食物恢复的饱食度来判定食物消耗时间和产魔量，大致如下：
   * 食物饱食度最大只能为12点，超过此数强制限定回12点
   * 吃掉食物的冷却时间为$$饱食度\times10$$ tick（游戏中一秒大约是20tick），冷却时间内不能再投食，否则食物会直接消失而不产生任何魔力。
   * 产魔量为$$饱食度^2\times70$$。
3. 记住当前食物名称，进行下一次产魔。
4. 如果还是相同食物，产魔量变成$$\frac{饱食度^2\times70}{食物数量}$$。

两次改动使得彼方兰自动化稍微复杂了一些，总的来说有两种方法可以轻松解决：

* 鉴于彼方兰只记住最后一次投喂的食物，前后交替投喂两种不同的食物即可。
* 彼方兰打掉后会清除掉所有的NBT数据，只需要投喂一次后打掉彼方兰，而后重新放置投喂即可。

第一条方案简单好用，只需要控制好时间间隔，基本上和原来旧版本投喂没有任何区别，只不过需要多增加一种食物来源。

第二条方案可能会更具挑战性，但同时也更具趣味性，如何做到植物魔法自动化是一个很有趣的游戏过程。



这里我设计了一个活塞+手掌花的系统来自动拆掉重放彼方兰：

![1](https://public.lightpic.info/image/E781_5A228EC10.jpg)

![2](https://public.lightpic.info/image/CEB0_5A228EC10.jpg)

![3](https://public.lightpic.info/image/17D5_5A228EC10.jpg)

设计思路也很简单：

* 活塞推动泥土，使彼方兰掉落下来。
* 小型手掌花见到彼方兰，大约3秒后重新放置在泥土上。
* 投掷器投喂食物产魔。
* 产魔完毕后活塞运作推动泥土，使彼方兰掉落。

有几个注意事项说明下：

* 图中的中继器必须要有，因为要保证先推掉彼方兰，再投掷食物。
* 沙漏定时大致为：`彼方兰冷却时间+3秒+彼方兰魔力排出时间`。普通魔力发生器和精灵魔力发生器依据投喂食物饱食度不同，可能会比较慢。但是盖亚魔力发射器基本上是瞬间排干的。
